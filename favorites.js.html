<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: favorites.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: favorites.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Handles favorites page functionality and storing the recipes a user favorites.
 */
 import { addRecipebyList } from '../components/UserLocalStorage.js';

 // eslint-disable-next-line import/no-unresolved
 import apiKey from './apikey.js';
 
 const tokenKey = `&amp;apiKey=${apiKey}`;
 
 const storage = window.localStorage;
 const recipeLists = [];
 const selectedRecipes = [];
 
 async function getRecipeArr(idArr) {
   const fetchEndPoint = `https://api.spoonacular.com/recipes/informationBulk?ids=${idArr.join(',')}${tokenKey}&amp;includeNutrition=true`;
 
   console.log('fetch_endpoint', fetchEndPoint);
 
   const fetchResults = await fetch(fetchEndPoint)
     .then((response) => response.json())
     .catch((error) => {
       console.error('Fetch in favorite page failed');
       console.error(error);
     });
 
   console.log('result is: ', fetchResults);
   return fetchResults;
 }
 
 async function init() {
   if ('serviceWorker' in navigator) {
     window.addEventListener('load', () => {
       navigator.serviceWorker.register('../sw.js').then(
         () => {},
         (err) => {
           console.error(err);
         }
       );
     });
   }
 
   // Detect if the device is mobile or PC
   const isMobile = window.matchMedia('only screen and (max-width: 768px)').matches;
   // intiallize the sidebar
   const navbarComponent = document.querySelector('navbar-component');
   const sidebarContent = navbarComponent.shadow.querySelector('.sidebar-content');
   sidebarContent.style.display = 'none';
 
   const sidebarButton = navbarComponent.shadow.querySelector('.sidebar-button');
   sidebarButton.addEventListener('click', () => {
     if (!isMobile) {
       if (sidebarContent.style.display !== 'none') {
         const mainSection = document.querySelector('.favorites-page');
         mainSection.style.marginLeft = `${225}px`;
       } else {
         const mainSection = document.querySelector('.favorites-page');
         mainSection.style.marginLeft = `${0}px`;
       }
     }
   });
 
   const mainSection = document.querySelector('.favorites-page');
  
   /**
    * Add all different favorites lists to the page
    *  - localStorage stores the lists. Each list stores the IDs of food items
    *  - A user-list element is created for each favorites list 
    */
   for (let i = 0; i &lt; localStorage.length; i += 1) {
     // do not display master favorites on favorites page
     if (localStorage.key(i) === 'favorites-master') continue;
     // get one list
     const userList = document.createElement('user-list');
     const arrRecipeId = JSON.parse(storage.getItem(localStorage.key(i)));
     console.log('arrRecipeId = ', arrRecipeId);
     let recipeArr = [];
 
     // eslint-disable-next-line no-await-in-loop
     if (arrRecipeId.length) recipeArr = await getRecipeArr(arrRecipeId);
     userList.list = recipeArr;
     userList.listName = localStorage.key(i);
     userList.addEventListener('selected', (event) => {
       selectedRecipes.push(event.detail);
       console.log("selected recipes (selected):",selectedRecipes);
     });
     userList.addEventListener('deselected', (event) => {
       selectedRecipes.pop(event.detail);
       console.log("selected recipes (deselected):",selectedRecipes);
     });
     if (userList.listName === 'My Favorites') {
       mainSection.insertBefore(userList, mainSection.firstChild);
     } else {
       mainSection.appendChild(userList);
     }
     recipeLists.push(userList);
   }
   
   // Display  emptyMessage if "My favorites" list is empty
   const emptyMessage = "No favorites added yet!";
   if(JSON.parse(localStorage["My Favorites"]).length == 0){
     const listName = document.querySelector('user-list').shadowRoot.querySelector('.list-name');
     const isEmptyMessage = document.createTextNode(emptyMessage);
     listName.appendChild(isEmptyMessage);
   }
 }
 
 
 
 window.addEventListener('DOMContentLoaded', init);
 
 // eslint-disable-next-line no-unused-vars
 async function getRecipebyID(id) {
   const fetchEndPoint = `https://api.spoonacular.com/recipes/${id}/information${tokenKey}&amp;includeNutrition=true`;
 
   // console.log("fetch_endpoint", fetchEndPoint);
 
   const fetchResults = await fetch(fetchEndPoint)
     .then((response) => response.json())
     .catch((error) => {
       console.error('Fetch in favorite page failed');
       console.error(error);
     });
 
   // console.log("result is: ", fetchResults);
   return fetchResults;
 }
 
 /**
  * User button click functions below 
  */
 
 let editMode = false;
 const editButton = document.getElementById('edit');
 const cancelButton = document.getElementById('cancel');
 const moveButton = document.getElementById('move');
 
 editButton.addEventListener('click', () => {
   if (editMode) return;
   editMode = true;
   document.body.style.backgroundColor = '#EEEEEE';
   editButton.style.display = 'none';
   cancelButton.style.display = 'inline-block';
   moveButton.style.display = 'inline-block';
   // edit favorites list titles
   const listTitles = document.querySelectorAll('h4');
   for (let i = 0; i &lt; listTitles.length; i += 1) {
     listTitles[i].setAttribute('contenteditable', true);
   }
   for (const list of recipeLists) {
     for (let i = 0; i &lt; list.list.length; i += 1) {
       list.list[i].enterSelectMode();
     }
   }
 });
 
 cancelButton.addEventListener('click', () => {
   if (!editMode) return;
   // cancel the edit mode
   editMode = false;
   document.body.style.backgroundColor = '#FFFFFF';
   editButton.style.display = 'inline-block';
   cancelButton.style.display = 'none';
   moveButton.style.display = 'none';
   // edit favorites list titles
   const listTitles = document.querySelectorAll('h4');
   for (let i = 0; i &lt; listTitles.length; i += 1) {
     listTitles[i].setAttribute('contenteditable', false);
   }
   for (const list of recipeLists) {
     for (let i = 0; i &lt; list.list.length; i += 1) {
       list.list[i].exitSelectMode();
     }
   }
 });
 
 moveButton.addEventListener('click', () => {
   if (!editMode || selectedRecipes) return;
   const modal = document.querySelector('.modal');
   for (let i = 0; i &lt; localStorage.length; i += 1) {
     if (localStorage.key(i) === 'favorites-master' || localStorage.key(i) === 'My Favorites ') continue;
     const button = document.createElement('button');
     button.innerHTML = localStorage.key(i);
     button.addEventListener('click', () => {
       for (const id of selectedRecipes) {
         addRecipebyList(localStorage.key(i), id);
       }
       document.location.reload(true);
     });
     modal.appendChild(button);
   }
   modal.style.display = 'block';
 });
 </code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addToCheckedLists">addToCheckedLists</a></li><li><a href="global.html#addToCustomList">addToCustomList</a></li><li><a href="global.html#clearResults">clearResults</a></li><li><a href="global.html#editMode">editMode</a></li><li><a href="global.html#formatTime">formatTime</a></li><li><a href="global.html#hideDropdown">hideDropdown</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initializeDropdown">initializeDropdown</a></li><li><a href="global.html#initializeHearts">initializeHearts</a></li><li><a href="global.html#initLocalStorageDoubt">initLocalStorageDoubt</a></li><li><a href="global.html#lookup">lookup</a></li><li><a href="global.html#showDropdown">showDropdown</a></li><li><a href="global.html#showResults">showResults</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Mon Dec 06 2021 03:02:24 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
