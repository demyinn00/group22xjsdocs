<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: recipe.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: recipe.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Handles the recipe page functionality. Recipe page is when the user clicks on a recipe and the actual full page with all information
 * pulls up for it.
 */
import apiKey from './apikey.js';
// const apiKey = '9311cd98c1aa422fa4acba526d943064';
const tokenKey = '?apiKey=' + apiKey;

window.addEventListener('DOMContentLoaded', init);

/**
 * Initializes the recipe page
 */
async function init() {
	if ('serviceWorker' in navigator) {
		window.addEventListener('load', function () {
			navigator.serviceWorker.register('../sw.js').then(
				() => {},
				(err) => {
					console.error(err);
				}
			);
		});
	}
	const data = await lookup(); // This might actually be slow, might be better to load concurrently with DOM elements rather than after
	const recipe = data[0];
	const equipment = data[1];

	console.log(recipe);
	console.log(equipment);

	// Set recipe image
	const recipeImg = document.querySelector('.recipe-image');
	recipeImg.src = recipe.image;

	// Set recipe title
	const recipeName = document.querySelector('.recipe-name');
	recipeName.innerHTML =
		recipe.title +
		`&lt;button class="favorite-heart">
	   		&lt;img src="../assets/favorite.svg"/>
	 	&lt;/button>
		 &lt;div class="dropdown-content">
			&lt;label class="container">My Favorites
			&lt;input type="checkbox">
			&lt;span class="checkmark"> &lt;/span>
			&lt;/label>

    	&lt;label class="entry">Create a new list: 
      		&lt;input type="text">
    	&lt;/label>
    
    	&lt;button class="submit">Submit &lt;/button>
  	&lt;/div>`;

	//show the drop-down box and change the heart color
	let isFavorite = false; //TODO: Need to search if the recipe is favorite
	let favoriteIcon = document.querySelector('.favorite-heart');
	favoriteIcon.addEventListener('click', () => {
		console.log('favoriteIcon clicked');
		if (!isFavorite) {
			console.log('show dropdown');
			isFavorite = true;
			favoriteIcon.src = '../assets/favorite-selected.svg';
			let dropdownContent = document.querySelector('.dropdown-content');
			dropdownContent.style.display = 'block';
		} else {
			console.log('hide dropdown');
			isFavorite = false;
			favoriteIcon.src = '../assets/favorite.svg';
			let dropdownContent = document.querySelector('.dropdown-content');
			dropdownContent.style.display = 'none';
		}
	});

	// Set prep time
	const prepTime = document.querySelector('#prep-time');
	const time = recipe.readyInMinutes;
	const timestr = formatTime(time);
	prepTime.innerHTML = timestr;

	// Set serving size
	const servingSize = document.querySelector('#serving-size');
	servingSize.innerHTML = recipe.servings;

	// Set description
	const recipeDescription = document.querySelector('.recipe-page-description');
	recipeDescription.innerHTML = recipe.summary;

	// Set ingredients using custom element
	const recipeIngredients = document.createElement('image-card-component');
	recipeIngredients.ingredients = recipe.extendedIngredients;
	document
		.querySelector('.ingredients-equipment')
		.appendChild(recipeIngredients);

	// Set equipment using custom element
	const recipeEquipment = document.createElement('image-card-component');
	recipeEquipment.equipment = equipment.equipment;
	document.querySelector('.ingredients-equipment').appendChild(recipeEquipment);

	// Set instructions by getting the analyzedInstructions object
	const recipeSteps = document.querySelector('.recipe-steps');
	const instructionsList = recipe.analyzedInstructions[0].steps;
	for (const instructionNumber in instructionsList) {
		let currStep = document.createElement('li');
		currStep.innerText = instructionsList[instructionNumber].step;
		recipeSteps.appendChild(currStep);
	}
}

/**
 * Performs a recipe lookup based on the id passed in to the page URL
 * @returns {object} json containing recipe information
 */
function lookup() {
	const regex = 'id=';
	const id = window.location.href.substring(
		window.location.href.search(regex) + 3,
		window.location.href.length
	); // Using regex to grab id from URL
	const fetchEndpointR =
		'https://api.spoonacular.com/recipes/' + id + '/information' + tokenKey;
	const fetchEndpointE =
		'https://api.spoonacular.com/recipes/' +
		id +
		'/equipmentWidget.json' +
		tokenKey;

	const fetchResultsR = fetch(fetchEndpointR)
		.then((response) => response.json())
		.catch((error) => {
			console.error('Recipe fetch in lookup failed');
			console.error(error);
		});

	const fetchResultsE = fetch(fetchEndpointE)
		.then((response) => response.json())
		.catch((error) => {
			console.error('Equipment fetch in lookup failed');
			console.error(error);
		});

	return Promise.all([fetchResultsR, fetchResultsE]);
}

/**
 * Converts a value of minutes into a string that shows hours and minutes
 * @param   {number} time - A time in minutes
 * @returns {string} - A string in the form 'XX hours XX minutes'
 */
function formatTime(time) {
	if (time == 1) return time.toString() + ' minute';
	if (time &lt; 70) return time.toString() + ' minutes';
	let hour = Math.floor(time / 60);
	let hrstr = '' + hour;
	let min = time % 60;
	let minstr = '' + min;

	if (hour == 1) hrstr = hrstr + ' hour';
	else hrstr = hrstr + ' hours';

	if (min == 0) minstr = '';
	else if (min == 1) minstr = minstr + ' minute';
	else minstr = minstr + ' minutes';

	return hrstr + ' ' + minstr;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#clearObject">clearObject</a></li><li><a href="global.html#clearResults">clearResults</a></li><li><a href="global.html#formatTime">formatTime</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initLocalStorageDoubt">initLocalStorageDoubt</a></li><li><a href="global.html#lookup">lookup</a></li><li><a href="global.html#search">search</a></li><li><a href="global.html#showResults">showResults</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sat Nov 20 2021 21:53:45 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
